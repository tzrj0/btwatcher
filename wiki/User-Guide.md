# 使用教程

本教程将详细介绍 BT Watcher 的各项功能和使用方法。

## 界面概览

### 主界面组成

1. **顶部状态栏**
   - 总请求数：显示监控期间的总访问次数
   - 独立 IP：不重复的访问者 IP 数量
   - 错误数：4xx 和 5xx 状态码的请求数
   - 监控时长：当前监控会话的持续时间
   - 连接状态：显示与宝塔面板的连接状态

2. **控制面板**
   - 站点选择：选择要监控的网站
   - UA 监控：设置 User-Agent 关键词过滤
   - 路径过滤：按访问路径过滤日志
   - 状态码过滤：按 HTTP 状态码筛选

3. **日志显示区**
   - 实时显示访问日志
   - 支持排序、筛选和搜索

4. **操作按钮**
   - 开始/停止监控
   - 导出日志
   - 清空显示
   - 设置

## 基本操作

### 1. 选择监控站点

1. 在"选择站点"下拉菜单中选择要监控的网站
2. 系统会自动加载该站点的日志文件列表
3. 选择要监控的日志文件（通常是最新的）

### 2. 设置过滤条件

#### UA 监控关键词
用于监控特定的爬虫或客户端：
```
bot,spider,crawler,curl
```

#### 路径过滤
监控特定路径的访问：
```
/admin,/wp-admin,/phpmyadmin
```

#### 状态码过滤
- 2xx：正常访问
- 3xx：重定向
- 4xx：客户端错误（如 404）
- 5xx：服务器错误

### 3. 开始监控

点击"开始监控"按钮，系统将：
1. 连接到宝塔面板
2. 实时读取日志更新
3. 按设定的刷新间隔更新显示

## 高级功能

### 1. 实时封禁

发现恶意访问时，可以快速封禁：

1. **单个封禁**
   - 右键点击日志行
   - 选择"封禁此 IP"
   - 输入封禁原因（可选）

2. **批量封禁**
   - 按住 Ctrl/Cmd 选择多行
   - 右键选择"批量封禁"

### 2. 黑名单管理

#### IP 黑名单
自动封禁匹配的 IP：
```
192.168.1.100
10.0.0.0/8
```

#### UA 黑名单
自动封禁特定 User-Agent：
```
badbot
malicious-scanner
```

### 3. 数据统计

点击"统计"查看：
- IP 访问排行
- 页面访问排行
- 状态码分布
- 访问趋势图

### 4. 日志导出

支持多种格式导出：

1. **CSV 格式**
   - 适合 Excel 分析
   - 包含所有字段

2. **JSON 格式**
   - 适合程序处理
   - 保留完整数据结构

3. **TXT 格式**
   - 纯文本格式
   - 易于阅读

### 5. 高级过滤

#### 正则表达式
使用 `/pattern/` 格式：
```
/\.(php|asp|jsp)$/  # 匹配动态页面
/bot|spider/i       # 不区分大小写匹配爬虫
```

#### 组合条件
同时使用多个过滤条件：
- IP 范围 + 路径
- UA 关键词 + 状态码
- 时间范围 + IP

## 设置选项

### 1. 刷新设置
- **刷新间隔**：1-60 秒（默认 5 秒）
- **最大显示行数**：100-10000（默认 1000）

### 2. 显示设置
- **高亮显示**：错误请求用红色标记
- **时间格式**：12/24 小时制
- **自动滚动**：新日志自动滚动到底部

### 3. 安全设置
- **自动封禁**：达到阈值自动封禁
- **封禁时长**：临时或永久
- **白名单**：永不封禁的 IP

### 4. 通知设置
- **声音提醒**：发现异常访问时
- **桌面通知**：重要事件通知

## 快捷键

- `Ctrl/Cmd + F`：搜索
- `Ctrl/Cmd + E`：导出
- `Ctrl/Cmd + R`：刷新
- `Ctrl/Cmd + S`：设置
- `Space`：暂停/继续
- `Esc`：清除选择

## 最佳实践

### 1. 性能优化
- 长时间监控时定期清空显示
- 使用过滤器减少无关日志
- 适当增加刷新间隔

### 2. 安全建议
- 定期检查黑名单
- 设置 IP 白名单避免误封
- 导出重要日志备份

### 3. 监控技巧
- 使用 UA 过滤快速识别爬虫
- 关注 4xx/5xx 错误
- 监控敏感路径访问

## 故障排查

遇到问题时：
1. 检查连接状态指示器
2. 查看控制台错误信息
3. 尝试重新连接
4. 参考[故障排查指南](Troubleshooting.md)

## 更多帮助

- [常见问题](FAQ.md)
- [功能说明](Features.md)
- [GitHub Issues](https://github.com/tzrj0/btwatcher/issues)