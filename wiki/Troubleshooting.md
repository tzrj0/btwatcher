# 故障排查指南

## 连接问题

### 无法连接到宝塔面板

#### 症状
- 提示"连接失败"
- 提示"网络错误"
- 连接超时

#### 解决方法

1. **检查网络连接**
   ```bash
   # 测试网络连通性
   ping 你的宝塔面板IP
   telnet 你的宝塔面板IP 端口
   ```

2. **验证 API 设置**
   - 登录宝塔面板
   - 进入"面板设置"→"API接口"
   - 确认 API 已开启
   - 检查 IP 白名单是否包含您的 IP 或设置为 `0.0.0.0/0`

3. **检查防火墙**
   - 确保宝塔面板端口未被防火墙阻止
   - Windows 防火墙可能需要添加例外
   - 检查路由器端口转发设置

4. **SSL 证书问题**
   - 如果使用 HTTPS，确保证书有效
   - 自签名证书可能需要特殊处理

### API 认证失败

#### 症状
- 提示"API密钥错误"
- 提示"认证失败"

#### 解决方法

1. **重新生成密钥**
   - 在宝塔面板重新生成 API 密钥
   - 确保完整复制，没有空格或换行

2. **检查时间同步**
   - 确保本地时间与服务器时间同步
   - 时间差异可能导致认证失败

## 性能问题

### 应用运行缓慢

#### 症状
- 界面卡顿
- 响应延迟
- CPU 占用高

#### 解决方法

1. **调整显示设置**
   ```
   设置 → 显示设置
   - 减少最大显示行数（如 500）
   - 增加刷新间隔（如 10 秒）
   ```

2. **使用过滤器**
   - 过滤掉不需要的日志
   - 减少数据处理量

3. **清理历史数据**
   - 定期点击"清空显示"
   - 重启应用释放内存

### 内存占用过高

#### 症状
- 内存使用持续增长
- 系统变慢
- 可能崩溃

#### 解决方法

1. **限制日志条目**
   - 设置合理的最大显示行数
   - 避免长时间运行不清理

2. **检查内存泄漏**
   - 更新到最新版本
   - 报告异常内存使用情况

## 显示问题

### 日志不更新

#### 症状
- 日志停止刷新
- 显示"已断开连接"

#### 解决方法

1. **检查连接状态**
   - 查看右上角连接指示器
   - 尝试手动刷新

2. **重新连接**
   - 停止监控
   - 重新选择站点
   - 开始监控

3. **检查日志文件**
   - 确保宝塔面板日志正常生成
   - 检查日志文件权限

### 中文显示乱码

#### 症状
- 中文显示为问号或方块
- 字符编码错误

#### 解决方法

1. **检查系统编码**
   - 确保系统支持 UTF-8
   - 检查区域设置

2. **重新安装字体**
   - 安装中文字体包
   - 重启应用

## 功能问题

### 无法封禁 IP

#### 症状
- 封禁操作失败
- 没有效果

#### 解决方法

1. **检查权限**
   - 确保 API 密钥有足够权限
   - 检查防火墙设置权限

2. **验证防火墙服务**
   - 确保宝塔防火墙已启用
   - 检查 iptables/firewalld 状态

### 导出失败

#### 症状
- 导出没有响应
- 文件损坏

#### 解决方法

1. **检查磁盘空间**
   - 确保有足够空间
   - 清理临时文件

2. **减少导出数据量**
   - 分批导出
   - 使用过滤器限制范围

## 崩溃和错误

### 应用崩溃

#### 收集信息
1. 查看错误日志
   - Windows: `%APPDATA%\bt-watcher\logs`
   - macOS: `~/Library/Logs/bt-watcher`
   - Linux: `~/.config/bt-watcher/logs`

2. 记录崩溃前操作
3. 系统信息（OS版本、内存等）

#### 临时解决
1. 删除配置文件重置
2. 以安全模式启动
3. 降级到稳定版本

### 常见错误代码

| 错误代码 | 含义 | 解决方法 |
|---------|------|---------|
| E001 | 网络连接失败 | 检查网络和防火墙 |
| E002 | API 认证失败 | 验证密钥和白名单 |
| E003 | 数据解析错误 | 检查日志格式 |
| E004 | 权限不足 | 检查 API 权限 |
| E005 | 内存不足 | 增加内存或减少数据量 |

## 获取帮助

### 自助资源
- [常见问题 FAQ](FAQ.md)
- [GitHub Issues](https://github.com/tzrj0/btwatcher/issues)
- [Wiki 主页](Home.md)

### 报告问题
提交 Issue 时请包含：
1. 错误截图或日志
2. 系统环境信息
3. 复现步骤
4. 期望行为

### 联系支持
- GitHub: [@tzrj0](https://github.com/tzrj0)
- 邮箱: 参见项目主页

## 预防措施

### 定期维护
- 更新到最新版本
- 清理旧日志文件
- 备份重要配置

### 最佳实践
- 合理设置刷新间隔
- 使用过滤器减少负载
- 定期重启释放资源
- 监控系统资源使用